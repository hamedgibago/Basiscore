
console.log("%cWelcome To BasisCore Ecosystem\n%c follow us on https://BasisCore.com/\nversion:1.1.1"," background: yellow;color: #0078C1; font-size: 2rem; font-family: Arial; font-weight: bolder","color: #0078C1; font-size: .73rem; font-family: Arial;");class Convertor{static ToCommand(element){var core=element.getAttribute('core');var retVal;switch(core){case"group":{retVal=new Group(element);break;}
case"print":{retVal=new Print(element);break;}
case"tree":{retVal=new Tree(element);break;}
case"list":{retVal=new List(element);break;}
case"view":{retVal=new View(element);break;}
case"dbsource":{retVal=new DbSource(element);break;}
case"call":{retVal=new Call(element);break;}
case"cookie":{retVal=new Cookie(element);break;}
default:{retVal=new UnknownCommand(element);break;}}
return retVal;}}
class DataSet{constructor(){this.Tabels={};}}
class DataTable{constructor(name,columns){this.Name=name;this.Columns=columns;this.Rows=new Array();}
UpdateColumnList(){this.Columns=Object.getOwnPropertyNames(this.Rows[0]);}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class Program{static Main(){window.onload=(e)=>__awaiter(this,void 0,void 0,function*(){yield RequestContext.Current.RenderAsync();});}}
Program.Main();class StringResult{constructor(value){this.value=value;}}
class TableDataSource{constructor(table){this.Type=DataSourceType.Table;this.Data=table;this.Id=table.Name;}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class Util{static ReplaceEx(source,searchValue,replaceValue){return source.replace(new RegExp(searchValue,'gi'),replaceValue);}
static ApplayFilter(source,filter){return(filter==null||filter=='')?source.Rows:alasql(`SELECT * FROM ? where ${filter}`,[source.Rows]);}
static ApplySort(source,sort){var retVal=source;if(sort){retVal=new DataTable(source.Name,source.Columns);retVal.Rows=alasql(`SELECT * FROM ? order by ${sort}`,[source.Rows]);}
return retVal;}
static ApplySql(source,sql){var retVal=source;if(sql){retVal=new DataTable(source.Name,source.Columns);retVal.Rows=alasql(Util.ReplaceEx(sql,`\\[${source.Name}\\]`,'?'),[source.Rows]);}
return retVal;}
static AddToContext(datatable,context,preview=false,sort=null,postSql=null){Util.AddRowNumber(datatable);if(postSql){datatable=Util.ApplySql(datatable,postSql);datatable.UpdateColumnList();}
if(sort){datatable=Util.ApplySort(datatable,sort);datatable.UpdateColumnList();}
var source=new TableDataSource(datatable);context.AddDataSource(source);if(preview||context.DebugContext.InDebugMode){context.AddPreview(source);}}
static AddRowNumber(datatable){var index=1;datatable.Rows.forEach(row=>{row.rownumber=index++;});datatable.UpdateColumnList();}
static Equal(a,b){var retVal=true;if(!Util.HasValue(a)||!Util.HasValue(b)){retVal=false;}
else{var aProps=Object.getOwnPropertyNames(a);var bProps=Object.getOwnPropertyNames(b);if(aProps.length!=bProps.length){retVal=false;}
else{for(var i=0;i<aProps.length;i++){var propName=aProps[i];if(a[propName]!==b[propName]){retVal=false;break;}}}}
return retVal;}
static ToDataSet(json){var obj=JSON.parse(json);var retVal=new DataSet();Object.getOwnPropertyNames(obj).forEach((tblName,_i,_)=>{var rawTbl=obj[tblName];var tbl=Util.ToDataTable(rawTbl,tblName);retVal.Tabels[tblName]=tbl;});return retVal;}
static ToDataTable(rawTbl,tblName){var cols=rawTbl.shift();cols=cols.map(x=>x.toLowerCase().trim());var retVal=new DataTable(tblName,cols);rawTbl.forEach((rawRow,__i,__)=>{var row={};cols.forEach((col,_ii,__)=>{row[col]=rawRow[_ii];});retVal.Rows.push(row);});return retVal;}
static GetValueOrDefaultAsync(token,context,defaultValue=null){return __awaiter(this,void 0,void 0,function*(){return(yield(token===null||token===void 0?void 0:token.GetValueAsync(context)))||defaultValue;});}
static GetValueOrSystemDefaultAsync(token,context,key){return __awaiter(this,void 0,void 0,function*(){var retVal;if(Util.HasValue(token)){retVal=yield token.GetValueAsync(context);}
else{retVal=context.GetDefault(key);}
return retVal;});}
static IsEqual(stringA,stringB){return(stringA||'').IsEqual(stringB);}
static HasValue(data){return(data!==undefined&&data!=null);}
static ToStringToken(data){return Util.ToToken(data,x=>new StringValue(x),x=>new StringObject(x),(...x)=>new StringArray(...x));}
static ToIntegerToken(data){return Util.ToToken(data,x=>new IntegerValue(parseInt(x)),x=>new IntegerObject(x),(...x)=>new IntegerArray(...x));}
static ToBooleanToken(data){return Util.ToToken(data,x=>new BooleanValue(Util.IsEqual(x,'true')),x=>new BooleanObject(x),(...x)=>new BooleanArray(...x));}
static ToToken(data,newValueToken,newObjectToken,newArrayToken){var tmp=RequestContext.Current.GetDefault('binding.regex','\\[##([^#]*)##\\]');var retVal;if(Util.HasValue(data)){var match=data.match(tmp);if(!match){retVal=newValueToken(data);}
else{var list=new Array();do{if(match.index!=0){list.push(newValueToken(match.input.substring(0,match.index)));}
list.push(newObjectToken(match[1]));data=data.substring(match.index+match[0].length);match=data.match(tmp);}while(match);if(data.length>0){list.push(newValueToken(data));}
if(list.length==1){retVal=list[0];}
else{retVal=newArrayToken(...list);}}}
return retVal;}
static FindElementRootCommandNode(rootElement){var retVal=[];var prodcess=(child)=>{if(child instanceof Element&&child.IsBasisCore()){retVal.push(child);}
else{child.childNodes.forEach(prodcess);}};rootElement.childNodes.forEach(prodcess);return retVal;}}
class VoidResult{}
VoidResult.Result=new VoidResult();class Context{constructor(debugContext){this.Repository={};this.DebugContext=debugContext;}
AddDataSource(source){source.Id=source.Id.toLowerCase();source.Data.Name=source.Data.Name.toLowerCase();this.Repository[source.Id]=source;this.DebugContext.LogInformation(`${source.Id} Added`);}}
class DebugContext{constructor(hostSetting){var _a;this.RequestId="0";this.InDebugMode=(_a=hostSetting.Debug)!==null&&_a!==void 0?_a:false;}
AddDebugInformation(debugInfo){throw new Error("Method not implemented.");}
LogError(message,exception){if(this.InDebugMode){console.error(message,exception);}}
LogInformation(message){if(this.InDebugMode){console.info(message);}}
LogWarning(message){if(this.InDebugMode){console.warn(message);}}
Complete(){throw new Error("Method not implemented.");}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class LocalContext extends Context{constructor(owner){super(owner.DebugContext);this.Resolves={};this.OnDataSourceAdded=[];this.Owner=owner;if(owner instanceof LocalContext){var localContextOwner=this.Owner;localContextOwner.OnDataSourceAdded.push(x=>this.OnDataSourceAddedHandler(x));}}
CheckSourceHeartbeatAsync(source){return __awaiter(this,void 0,void 0,function*(){return yield this.Owner.CheckSourceHeartbeatAsync(source);});}
AddPreview(source){this.Owner.AddPreview(source);}
LoadDataAsync(sourceName,connectionName,parameters){return __awaiter(this,void 0,void 0,function*(){return yield this.Owner.LoadDataAsync(sourceName,connectionName,parameters);});}
LoadPageAsync(pageName,rawCommand,pageSize,callDepth){return __awaiter(this,void 0,void 0,function*(){return yield this.Owner.LoadPageAsync(pageName,rawCommand,pageSize,callDepth);});}
OnDataSourceAddedHandler(source){var _a;(_a=this.Resolves[source.Id])===null||_a===void 0?void 0:_a.forEach(fn=>fn(source));delete this.Resolves[source.Id];this.OnDataSourceAdded.forEach(fn=>fn(source));}
GetDefault(key,defaultValue){return this.Owner.GetDefault(key,defaultValue);}
TryGetDataSource(dataSourceId){var _a;return(_a=this.Repository[dataSourceId])!==null&&_a!==void 0?_a:this.Owner.TryGetDataSource(dataSourceId);}
WaitToGetDataSourceAsync(dataSourceId){return new Promise((resolve,reject)=>{var retVal=this.TryGetDataSource(dataSourceId);if(retVal){resolve(retVal);}
else{this.DebugContext.LogInformation(`wait for ${dataSourceId}`);var tmp=this.Resolves[dataSourceId];if(!tmp){tmp=[];this.Resolves[dataSourceId]=tmp;}
tmp.push(resolve);}});}
AddDataSource(source){super.AddDataSource(source);this.OnDataSourceAddedHandler(source);}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class RequestContext extends Context{constructor(debugContext){super(debugContext);this._checkedSourceHeartbeat={};this.HostSetting=host;}
static get Current(){if(RequestContext._current==null){alasql.options.casesensitive=false;try{RequestContext._current=new RequestContext(new DebugContext(host));}
catch(_a){throw new Error("host object not found");}}
return RequestContext._current;}
RenderAsync(){return __awaiter(this,void 0,void 0,function*(){var rejected=false;try{if(this.HostSetting.OnRendering){var reason=this.HostSetting.OnRendering();if(reason){rejected=true;throw new Error(reason);}}}
catch(ex){this.DebugContext.LogError('Error in Execute Host.OnRendering Method',ex);}
if(!rejected){this.AddLocalDataAsDataSource();var group=new Group(document.body);yield group.ExecuteAsync(this);try{if(this.HostSetting.OnRendered){this.HostSetting.OnRendered();}}
catch(ex){this.DebugContext.LogError('Error In Run Host.OnRendered Method',ex);}}});}
AddLocalDataAsDataSource(){var cookieValues=document.cookie.split(';').map(x=>x.split('='));var data=new Array();data.push(cookieValues.map(x=>x[0]));data.push(cookieValues.map(x=>x[1]));Util.AddToContext(Util.ToDataTable(data,'cms.cookie'),this);var request=new Array();request.push(['requestId','hostip','hostport']);request.push(['-1',window.location.hostname,window.location.port]);Util.AddToContext(Util.ToDataTable(request,'cms.request'),this);var toTwoDigit=x=>("0"+x).slice(-2);var d=new Date();var ye=d.getFullYear();var mo=toTwoDigit(d.getMonth());var da=toTwoDigit(d.getDay());var ho=toTwoDigit(d.getHours());var mi=toTwoDigit(d.getMinutes());var se=toTwoDigit(d.getSeconds());var cms=new Array();cms.push(['Date','Time','Date2','Time2','Date3']);cms.push([`${ye}/${mo}/${da}`,`${ho}:${mi}`,`${ye}${mo}${da}`,`${ho}${mi}${se}`,`${ye}.${mo}.${da}`]);Util.AddToContext(Util.ToDataTable(cms,'cms.cms'),this);var query=window.location.search.substring(1);if(query.length>0){var querykeys=new Array();var queryValues=new Array();query.split('&').forEach(x=>{var pair=x.split('=');querykeys.push(pair[0]);queryValues.push(decodeURIComponent(pair[1]||''));});Util.AddToContext(Util.ToDataTable([querykeys,queryValues],'cms.query'),this);}
if(this.HostSetting.Sources){Object.getOwnPropertyNames(this.HostSetting.Sources).forEach(key=>{Util.AddToContext(Util.ToDataTable(this.HostSetting.Sources[key],key.toLowerCase()),this);});}}
LoadPageAsync(pageName,rawCommand,pageSize,callDepth){var parameters={'fileNames':pageName,'dmnid':this.GetDefault('dmnid',''),'sitesize':pageSize,'command':rawCommand};return this.Ajax(`${this.GetDefault('connections.web.callcommand')}${pageName}`,this.GetDefault('call.verb','get'),parameters);}
Ajax(url,methode,parameters){return new Promise((resolve,reject)=>{var xhr=new XMLHttpRequest();xhr.withCredentials=false;xhr.open(methode,url,true);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");xhr.onload=function(e){if(xhr.readyState===4){if(xhr.status===200){resolve(xhr.responseText);}
else{reject(xhr.statusText);}}};xhr.onerror=function(e){reject(xhr.statusText);};var encodedDataPairs=[];Object.getOwnPropertyNames(parameters).forEach((name,_i,_)=>encodedDataPairs.push(encodeURIComponent(name)+'='+encodeURIComponent(parameters[name])));xhr.send(encodedDataPairs.join('&').replace(/%20/g,'+'));});}
LoadDataAsync(sourceName,connectionName,parameters){return this.Ajax(this.GetConnection(`web.${connectionName}`),this.GetDefault('dbsource.verb','post'),parameters).then(x=>Util.ToDataSet(x));}
GetConnectionObject(source){return this.GetSetting(`connection.${source}`,null);}
GetConnection(source){var retVal;var value=this.GetConnectionObject(source);if(typeof(value)==='string'){retVal=value;}
else{var setting=value;retVal=setting.Connection;}
return retVal;}
CheckSourceHeartbeatAsync(source){return __awaiter(this,void 0,void 0,function*(){var retVal=this._checkedSourceHeartbeat[source];if(!Util.HasValue(retVal)){var value=this.GetConnectionObject(`web.${source}`);if(typeof(value)==='string'){retVal=Promise.resolve(true);}
else{var setting=value;if(!Util.HasValue(setting.Heartbeat)){retVal=Promise.resolve(true);}
else{var f=()=>__awaiter(this,void 0,void 0,function*(){var tmp;try{yield this.Ajax(setting.Heartbeat,'get',{});tmp=true;}
catch(_a){tmp=false;};this.DebugContext.LogInformation(`Checking '${source}' From '${setting.Heartbeat}' Is ${tmp}`);return tmp;});retVal=f();}
this._checkedSourceHeartbeat[source]=retVal;}}
return yield retVal;});}
GetSetting(key,defaultValue){var find=Object.getOwnPropertyNames(this.HostSetting.Settings).filter(x=>Util.IsEqual(x,key));var retVal=find.length==1?host.Settings[find[0]]:null;if(!retVal){if(defaultValue){retVal=defaultValue;}
else{throw new ConfigNotFoundException("host.settings",key);}}
return retVal;}
GetDefault(key,defaultValue){return this.GetSetting(`default.${key}`,defaultValue);}
AddPreview(source){var str="";source.Data.Rows.forEach(row=>{str+="<tr>";Object.getOwnPropertyNames(row).forEach(col=>{var value=row[col];str+=`<td>${Util.HasValue(value) ? value : ''}</td>`;});str+="</tr>";});var columnNameList="";var columnIndexList="";source.Data.Columns.forEach((col,index)=>{columnIndexList+=`<td>col${index + 1}</td>`;columnNameList+=`<td>${col}</td>`;});str=`<thead><tr><td colspan='${source.Data.Columns.length}'>${source.Id}</td></tr><tr>${columnIndexList}</tr><tr>${columnNameList}</tr></thead><tbody>${str}</tbody> `;var tbl=document.createElement("table");tbl.innerHTML=str;document.body.appendChild(tbl);}
TryGetDataSource(dataSourceId){return this.Repository[dataSourceId];}
WaitToGetDataSourceAsync(dataSourceId){throw new Error(`Call WaitToGetDataSourceAsync In RequestContext For '${dataSourceId}'.No DataSource Add To this Context Dynamically.`);}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class CommandBase{constructor(element){this.Core=element.getAttribute('core');this.Id=element.getAttribute('id');this.Name=element.GetStringToken('name');this.RunType=element.GetStringToken('run');this.If=element.GetStringToken('if');this.Element=element;}
ExecuteAsync(context){return __awaiter(this,void 0,void 0,function*(){var retVal=null;try{switch(yield this.GetRunTypeValue(context)){case RunType.atclient:{if(yield this.GetIfValue(context)){retVal=yield this.ExecuteCommandAsync(context);}
else{this.Element.outerHTML="";retVal=VoidResult.Result;}}}
return retVal;}
catch(ex){this.Element.outerHTML=ex;context.DebugContext.LogError(`Error In Run ${this.Core}`,ex);}});}
ExecuteCommandAsync(context){throw new Error("'ExecuteCommandAsync' Not Implemented");}
GetIfValue(context){var _a;return __awaiter(this,void 0,void 0,function*(){var value=yield Util.GetValueOrDefaultAsync(this.If,context,null);return(_a=value===null||value===void 0?void 0:value.Evaluating())!==null&&_a!==void 0?_a:true;});}
GetRunTypeValue(context){return __awaiter(this,void 0,void 0,function*(){var value=yield Util.GetValueOrDefaultAsync(this.RunType,context,"atclient");return RunType[value.toLowerCase()];});}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class Command extends CommandBase{constructor(element){super(element);this.DataSourceId=element.GetStringToken('datamembername');}
ExecuteCommandAsync(context){return __awaiter(this,void 0,void 0,function*(){var dataSourceId=yield Util.GetValueOrDefaultAsync(this.DataSourceId,context,null);var source=null;if(dataSourceId){source=yield context.WaitToGetDataSourceAsync(dataSourceId);}
return yield this.ExecuteAsyncEx(source,context);});}
static ToCommand(element){return Convertor.ToCommand(element);}}
class UnknownCommand extends Command{constructor(element){super(element);}
ExecuteAsyncEx(dataSource,context){return null;}}
var DataSourceType;(function(DataSourceType){DataSourceType[DataSourceType["Table"]=0]="Table";DataSourceType[DataSourceType["Json"]=1]="Json";})(DataSourceType||(DataSourceType={}));var FaceRowType;(function(FaceRowType){FaceRowType[FaceRowType["NotSet"]=0]="NotSet";FaceRowType[FaceRowType["Odd"]=1]="Odd";FaceRowType[FaceRowType["Even"]=2]="Even";})(FaceRowType||(FaceRowType={}));var RunType;(function(RunType){RunType[RunType["atserver"]=0]="atserver";RunType[RunType["atclient"]=1]="atclient";RunType[RunType["none"]=2]="none";})(RunType||(RunType={}));class ClientException extends Error{constructor(message){super(message);}}
class ConfigNotFoundException extends ClientException{constructor(configFile,configKey){super(`In '${configFile}' object, property '${configKey}' not configured!`);}}
Object.defineProperty(Element.prototype,"GetStringToken",{value:function GetStringToken(attributeName){var retVal;var tmp=(this.getAttribute(attributeName));if(tmp){retVal=tmp.ToStringToken();}
return retVal;},writable:true,configurable:true});Object.defineProperty(Element.prototype,"GetIntegerToken",{value:function GetIntegerToken(attributeName){var retVal;var tmp=(this.getAttribute(attributeName));if(tmp){retVal=tmp.ToIntegerToken();}
return retVal;},writable:true,configurable:true});Object.defineProperty(Element.prototype,"GetBooleanToken",{value:function GetBooleanToken(attributeName){var retVal;var tmp=(this.getAttribute(attributeName));if(tmp){retVal=tmp.ToBooleanToken();}
return retVal;},writable:true,configurable:true});Object.defineProperty(Element.prototype,"GetTemplateToken",{value:function GetTemplateToken(){var retVal;if(this.children.length==1&&Util.IsEqual(this.children[0].nodeName,'script')&&Util.IsEqual(this.children[0].getAttribute('type'),"text/template")){retVal=this.textContent.ToStringToken();}
else{retVal=this.innerHTML.ToStringToken();}
return retVal;},writable:true,configurable:true});Object.defineProperty(Element.prototype,"IsBasisCore",{value:function IsBasisCore(){return this.nodeType==Node.ELEMENT_NODE&&this.nodeName=='BASIS'&&Util.IsEqual(this.getAttribute("run"),"atclient");},writable:true,configurable:true});Object.defineProperty(String.prototype,"Evaluating",{value:function Evaluating(){var _a;return Util.IsEqual((_a=eval(this.toString()))===null||_a===void 0?void 0:_a.toString(),'true');},writable:true,configurable:true});Object.defineProperty(String.prototype,"ToStringToken",{value:function ToStringToken(){return Util.ToStringToken(this.toString());},writable:true,configurable:true});Object.defineProperty(String.prototype,"ToIntegerToken",{value:function ToIntegerToken(){return Util.ToIntegerToken(this.toString());},writable:true,configurable:true});Object.defineProperty(String.prototype,"ToBooleanToken",{value:function ToBooleanToken(){return Util.ToBooleanToken(this.toString());},writable:true,configurable:true});Object.defineProperty(String.prototype,"IsEqual",{value:function IsEqual(value){var stringA=this.toString();return stringA.localeCompare(value!==null&&value!==void 0?value:'',undefined,{sensitivity:'accent'})==0;},writable:true,configurable:true});class Face{}
class FaceCollection extends Array{constructor(...faces){super(...faces);Object.setPrototypeOf(this,FaceCollection.prototype);}
Render(param,_context){var retVal="";if(this.length==0){retVal=param.Data[0].toString();param.SetRendered();}
else{var rowType=param.RowType;var firstMatchFace=this.filter(x=>{var con1=x.RelatedRows.some(x=>Util.Equal(x,param.Data));var con2=x.RowType==FaceRowType.NotSet||x.RowType==rowType;var con3=x.Levels==null||x.Levels.some(y=>param.Levels.some(x=>x==y));return con1&&con2&&con3;})[0];if(firstMatchFace!=null){if(firstMatchFace.FormattedTemplate!=null){retVal=FaceCollection.Format(firstMatchFace.FormattedTemplate,param.Data);if(firstMatchFace.ApplyReplace&&param.Replaces!=null){retVal=param.Replaces.Applay(retVal);}
if(firstMatchFace.ApplyFunction){}}
param.SetRendered();if(param.MustApplayDivider){retVal+=param.DividerTemplate;}
if(param.IsEnd){var tmp=param.EmptyCell;while(tmp>0){retVal+=param.IncompleteTemplate;tmp--;}}}
else{param.SetIgnored();}}
return retVal;}
static Format(format,object){var items=Object.getOwnPropertyNames(object).map((x,i)=>{return{value:object[x]||'',pattern:`@col${i + 1}`};}).reverse();items.forEach(x=>format=Util.ReplaceEx(format,x.pattern,x.value));return format;}}
class RawFace{constructor(element){this.ApplyReplace=element.GetBooleanToken('replace');this.ApplyFunction=element.GetBooleanToken('function');this.Level=element.GetStringToken('level');this.RowType=element.GetStringToken('rowtype');this.Filter=element.GetStringToken('filter');this.Template=element.GetTemplateToken();}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class RawFaceCollection extends Array{static Create(element){var retVal=new RawFaceCollection();element.querySelectorAll('face').forEach(x=>retVal.push(new RawFace(x)));return retVal;}
ProcessAsync(dataSource,context){return __awaiter(this,void 0,void 0,function*(){var facesTask=this.map((x)=>__awaiter(this,void 0,void 0,function*(){var _a,_b;var applyReplace=yield Util.GetValueOrDefaultAsync(x.ApplyReplace,context,false);var applyFunction=yield Util.GetValueOrDefaultAsync(x.ApplyFunction,context,false);var rowType=yield this.GetRowTypeAsync(x.RowType,context);var levels=(_b=(_a=(yield Util.GetValueOrDefaultAsync(x.Level,context)))===null||_a===void 0?void 0:_a.split("|"))!==null&&_b!==void 0?_b:null;var relatedRows=Util.ApplayFilter(dataSource.Data,yield Util.GetValueOrDefaultAsync(x.Filter,context));var template=yield Util.GetValueOrDefaultAsync(x.Template,context,'');dataSource.Data.Columns.forEach((col,index)=>{if(col.length>0){template=Util.ReplaceEx(template,`@${col}`,`@col${index + 1}`);}});return{ApplyFunction:applyFunction,ApplyReplace:applyReplace,RowType:rowType,FormattedTemplate:template,Levels:levels,RelatedRows:relatedRows};}));var faces=yield Promise.all(facesTask);return new FaceCollection(...faces);});}
GetRowTypeAsync(token,context){return __awaiter(this,void 0,void 0,function*(){var retVal=FaceRowType.NotSet;var value=yield Util.GetValueOrDefaultAsync(token,context);if(value){var list=Object.getOwnPropertyNames(FaceRowType).filter(x=>Util.IsEqual(x,value));retVal=list.length==1?FaceRowType[list[0]]:FaceRowType.NotSet;}
return retVal;});}}
class RawReplace{constructor(element){this.TagName=element.GetStringToken('tagname');this.Content=element.GetTemplateToken();}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class RawReplaceCollection extends Array{static Create(element){var retVal=new RawReplaceCollection();element.querySelectorAll('replace').forEach(x=>retVal.push(new RawReplace(x)));return retVal;}
ProcessAsync(context){return __awaiter(this,void 0,void 0,function*(){var taskList=this.map((x)=>__awaiter(this,void 0,void 0,function*(){return new Replace(yield Util.GetValueOrDefaultAsync(x.TagName,context),yield Util.GetValueOrDefaultAsync(x.Content,context));}));var list=yield Promise.all(taskList);return new ReplaceCollection(...list);});}}
class RenderParam{constructor(replaces,renderableCount,recoredPerRow,dividerTemplate,incompleteTemplate){this._RenderableCount=0;this._CellPerRow=0;this.Replaces=replaces;this._CellPerRow=recoredPerRow;this._RenderableCount=renderableCount;this.DividerTemplate=dividerTemplate;this.IncompleteTemplate=incompleteTemplate;this._RenderedCount=0;}
get IsEnd(){return this._RenderableCount==this._RenderedCount;}
get EmptyCell(){return this._CellPerRow-this._RenderedCell;}
get RowType(){return(this._RenderedCount%2==0)?FaceRowType.Even:FaceRowType.Odd;}
get MustApplayDivider(){return this.DividerTemplate!=null&&this._RenderedCell==0&&!this.IsEnd;}
SetLevel(levels){this.Levels=levels;}
SetRendered(){this._RenderedCount++;if(this._CellPerRow!=0){this._RenderedCell=this._RenderedCount%this._CellPerRow;}}
SetIgnored(){this._RenderedCount--;}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class RenderableBase extends Command{constructor(element){var _a,_b,_c;super(element);this.Layout=(_a=element.querySelector('layout'))===null||_a===void 0?void 0:_a.GetTemplateToken();this.ElseLayout=(_b=element.querySelector('else-layout'))===null||_b===void 0?void 0:_b.GetTemplateToken();this.IncompleteTemplate=(_c=element.querySelector('incomplete'))===null||_c===void 0?void 0:_c.GetTemplateToken();var devider=element.querySelector('divider');this.DividerTemplate=devider===null||devider===void 0?void 0:devider.GetTemplateToken();this.DividerRowcount=devider===null||devider===void 0?void 0:devider.GetIntegerToken("rowcount");this.RawReplaces=RawReplaceCollection.Create(element);this.RawFaces=RawFaceCollection.Create(element);}
ExecuteAsyncEx(dataSource,context){return __awaiter(this,void 0,void 0,function*(){var faces=yield this.RawFaces.ProcessAsync(dataSource,context);var replaces=yield this.RawReplaces.ProcessAsync(context);var dividerRowcount=yield Util.GetValueOrDefaultAsync(this.DividerRowcount,context,0);var dividerTemplate=yield Util.GetValueOrDefaultAsync(this.DividerTemplate,context);var incompleteTemplate=yield Util.GetValueOrDefaultAsync(this.IncompleteTemplate,context);var result=yield this.RenderAsync(dataSource,context,faces,replaces,dividerRowcount,dividerTemplate,incompleteTemplate);if(Util.HasValue(result)&&result.length>0){var layout=yield Util.GetValueOrDefaultAsync(this.Layout,context,'@child');result=Util.ReplaceEx(layout,'@child',result);}
else{result=yield Util.GetValueOrDefaultAsync(this.ElseLayout,context,"");}
this.Element.outerHTML=result;return new VoidResult();});}
RenderAsync(dataSource,context,faces,replaces,dividerRowcount,dividerTemplate,incompleteTemplate){return new Promise(resolve=>{var param=new RenderParam(replaces,dataSource.Data.Rows.length,dividerRowcount,dividerTemplate,incompleteTemplate);var result="";dataSource.Data.Rows.forEach((row,_index,_)=>{param.Data=row;result+=faces.Render(param,context);});resolve(result);});}}
class Replace{constructor(tagName,template){this.TagName=tagName;this.Template=template;}
Applay(result){var str=`\\[\\(${this.TagName}\\)(.+?)\\]`;var matches=result.matchAll(RegExp(str,"gi"));for(const match of matches){var template=this.Template;var params=match[1].split('|');params.forEach((param,index,_)=>template=template.replace(`@val${index + 1}`,param));result=result.replace(match[0],template);}
return result;}}
class ReplaceCollection extends Array{constructor(...elements){super(...elements);}
Applay(faceRenderResult){this.forEach(item=>faceRenderResult=item.Applay(faceRenderResult));return faceRenderResult;}}
class List extends RenderableBase{constructor(element){super(element);}}
class Print extends RenderableBase{constructor(element){super(element);}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class Tree extends RenderableBase{constructor(element){super(element);this.NullValue=element.GetStringToken('nullvalue');this.RelationColumnName=element.GetStringToken('relationnamecol');this.ForeignKey=element.GetStringToken('parentidcol');this.PrincipalKey=element.GetStringToken('idcol');}
RenderAsync(dataSource,context,faces,replaces,dividerRowcount,dividerTemplate,incompleteTemplate){return __awaiter(this,void 0,void 0,function*(){var retVal='';if(dataSource.Data.Rows.length!=0){var foreignKey=yield Util.GetValueOrDefaultAsync(this.ForeignKey,context,"parentid");var principalKey=yield Util.GetValueOrDefaultAsync(this.PrincipalKey,context,"id");var nullValue=yield Util.GetValueOrDefaultAsync(this.NullValue,context,"0");var rootRecord=alasql(`SELECT * FROM ? WHERE ${foreignKey} ${(Util.IsEqual(nullValue, 'null') ? 'is' : '=')} ${nullValue}`,[dataSource.Data.Rows]);if(rootRecord.length==0){throw new Error(`Tree Command Has No Root Record In Data Member '${dataSource.Id}' With '${nullValue}' Value In '${foreignKey}' Column That Set In NullValue Attribute.`);}
var rootRenderParam=new RenderParam(replaces,rootRecord.length,dividerRowcount,dividerTemplate,incompleteTemplate);rootRecord.forEach(row=>{rootRenderParam.Data=row;retVal+=this.RenderLevel(dataSource,rootRenderParam,1,faces,replaces,context,dividerRowcount,dividerTemplate,incompleteTemplate,principalKey,foreignKey);});};return retVal;});}
RenderLevel(dataSource,parentRenderParam,level,faces,replaces,context,dividerRowcount,dividerTemplate,incompleteTemplate,principalKey,foreignKey){var retVal="";var childRenderResult="";var childRows=alasql(`SELECT * FROM ? WHERE ${foreignKey} = ?`,[dataSource.Data.Rows,parentRenderParam.Data[principalKey]]);var groups={};if(childRows.length!=0){var newLevel=level+1;var childRenderParam=new RenderParam(replaces,childRows.length,dividerRowcount,dividerTemplate,incompleteTemplate);if(!this.RelationColumnName){childRows.forEach(row=>{childRenderParam.Data=row;childRenderResult+=this.RenderLevel(dataSource,childRenderParam,newLevel,faces,replaces,context,dividerRowcount,dividerTemplate,incompleteTemplate,principalKey,foreignKey);});groups[""]=childRenderResult;}
else{throw new Error(`RelationColumnName Not Implemented`);}
parentRenderParam.SetLevel([`${level}`]);}
else{groups[""]="";parentRenderParam.SetLevel([`${level}`,'end']);}
retVal=faces.Render(parentRenderParam,context);if(retVal){Object.getOwnPropertyNames(groups).forEach(key=>retVal=retVal.replace(`@child${key ? `(${key})` : ''}`,groups[key]));}
return retVal;}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class View extends RenderableBase{constructor(element){super(element);this.GroupColumn=element.GetStringToken('groupcol');}
RenderAsync(dataSource,context,faces,replaces,dividerRowcount,dividerTemplate,incompleteTemplate){return __awaiter(this,void 0,void 0,function*(){var retVal='';if(dataSource.Data.Rows.length!=0){var groupColumn=yield Util.GetValueOrSystemDefaultAsync(this.GroupColumn,context,"ViewCommand.GroupColumn");var groupList=alasql(`SELECT DISTINCT ${groupColumn} FROM ?`,[dataSource.Data.Rows]);var rootRenderParam=new RenderParam(replaces,groupList.length,dividerRowcount,dividerTemplate,incompleteTemplate);rootRenderParam.SetLevel(["1"]);groupList.forEach((group,_i,_)=>{var childItems=alasql(`SELECT * FROM ? where ${groupColumn} = ?`,[dataSource.Data.Rows,group[groupColumn]]);rootRenderParam.Data=childItems[0];var level1Result=faces.Render(rootRenderParam,context);var level2Result='';var childRenderParam=new RenderParam(replaces,childItems.length,dividerRowcount,dividerTemplate,incompleteTemplate);childRenderParam.SetLevel(["2"]);childItems.forEach((row,_i,_)=>{childRenderParam.Data=row;var renderResult=faces.Render(childRenderParam,context);if(renderResult){level2Result+=renderResult;}});retVal+=level1Result.replace('@child',level2Result);});};return retVal;});}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class Call extends CommandBase{constructor(element){super(element);this.FileName=element.GetStringToken('file');this.PageSize=element.GetStringToken('pagesize');}
ExecuteCommandAsync(context){return __awaiter(this,void 0,void 0,function*(){var filename=yield Util.GetValueOrDefaultAsync(this.FileName,context,null);var pagesize=yield Util.GetValueOrDefaultAsync(this.PageSize,context,null);var commnad=yield Util.GetValueOrDefaultAsync(this.Element.outerHTML.ToStringToken(),context);var result=yield context.LoadPageAsync(filename,commnad,pagesize,0);this.Element.outerHTML=result;return new VoidResult();});}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class Group extends CommandBase{constructor(element){super(element);this.Commands=[];}
ExecuteCommandAsync(context){return __awaiter(this,void 0,void 0,function*(){var tasks=Array();var localContext=new LocalContext(context);yield this.ProcessCallAsync(localContext);Util.FindElementRootCommandNode(this.Element).map(x=>Command.ToCommand(x)).forEach(command=>tasks.push(command.ExecuteAsync(localContext)));yield Promise.all(tasks);yield this.ReplaceNotationAsync(this.Element,localContext);if(Util.IsEqual(this.Core,'group')){this.Element.outerHTML=this.Element.innerHTML;}
return new VoidResult();});}
ProcessCallAsync(context){return __awaiter(this,void 0,void 0,function*(){var calls=Util.FindElementRootCommandNode(this.Element).filter(x=>Util.IsEqual(x.getAttribute('core'),'call'));while(calls.length>0){var commands=[];calls.forEach(element=>commands.push(Command.ToCommand(element)));var tasks=Array();commands.forEach(command=>tasks.push(command.ExecuteAsync(context)));yield Promise.all(tasks);calls=Util.FindElementRootCommandNode(this.Element).filter(x=>Util.IsEqual(x.getAttribute('core'),'call'));}});}
ReplaceNotationAsync(root,context){return __awaiter(this,void 0,void 0,function*(){if(root.nodeType==Node.TEXT_NODE){var token=yield this.CheckContentForNotationAsync(root.textContent);if(token){root.textContent=yield Util.GetValueOrDefaultAsync(token,context);}}
else{for(var index=0;index<root.attributes.length;index++){token=yield this.CheckContentForNotationAsync(root.attributes[index].value);if(token){root.attributes[index].value=yield Util.GetValueOrDefaultAsync(token,context);}}
root.childNodes.forEach(x=>{if(!(x instanceof Element)||!x.IsBasisCore()){this.ReplaceNotationAsync(x,context);}});}});}
CheckContentForNotationAsync(data){var token=data.ToStringToken();return(token instanceof StringObject||token instanceof StringArray)?token:null;};}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class Cookie extends CommandBase{constructor(element){super(element);this.Value=this.Element.GetStringToken('value');this.MaxAge=this.Element.GetStringToken('max-age');this.Path=this.Element.GetStringToken('path');}
ExecuteCommandAsync(context){return __awaiter(this,void 0,void 0,function*(){var name=yield Util.GetValueOrDefaultAsync(this.Name,context,null);var value=yield Util.GetValueOrDefaultAsync(this.Value,context,null);var maxAge=yield Util.GetValueOrDefaultAsync(this.MaxAge,context,null);var path=yield Util.GetValueOrDefaultAsync(this.Path,context,null);var str=`${name.trim()}=${value || ''}`;if(maxAge){str+=`;max-age=${maxAge}`;}
if(path){str+=`;path=${path.trim()}`;}
document.cookie=str;this.Element.remove();return VoidResult.Result;});}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class ArrayToken extends Array{constructor(...data){super(...data);}
GetValueAsync(context){return __awaiter(this,void 0,void 0,function*(){var tasks=new Array();this.forEach(token=>tasks.push(token.GetValueAsync(context)));var result=yield Promise.all(tasks);var retVal=this.TryParse(result.join(''));return retVal;});}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class ObjectToken{constructor(rawValue){this.Params=rawValue.split('|').map(part=>{var parts=part.toLowerCase().split('.');var retVal=new SimpleTokenElement();retVal.Column=parts.slice(2).join('.');retVal.Source=parts[0];retVal.Member=parts[1];return retVal;});}
GetValueAsync(context){return __awaiter(this,void 0,void 0,function*(){var retVal;for(var i=0;i<this.Params.length;i++){var item=this.Params[i];var isLastItem=(i+1==this.Params.length);if(item.Source.startsWith('(')){retVal=this.TryParse(item.Source.substr(1,item.Source.length-2));}
else{if(Util.HasValue(item.Member)){var dataMember=`${item.Source}.${item.Member}`;var dataSource=context.TryGetDataSource(dataMember);if(dataSource==null){if(isLastItem){if(dataMember.startsWith("cms.")){break;}
dataSource=yield context.WaitToGetDataSourceAsync(dataMember);}
else{continue;}}
var columnName=item.Column||dataSource.Data.Columns[1];columnName=columnName.toLowerCase();if(dataSource.Data.Columns.indexOf(columnName)==-1){if(isLastItem){break;}
else{continue;}}
if(dataSource.Data.Rows.length==1){var columnRawValue=dataSource.Data.Rows[0][columnName];var columnValue='';try{columnValue=columnRawValue.toString();}
catch(_a){}
if(!Util.HasValue(columnRawValue)||columnValue===''){if(!isLastItem){continue;}}
else{retVal=this.TryParse(columnValue);break;}}
else if(dataSource.Data.Rows.length>1){try{var sb="";var data=dataSource.Data.Rows.filter(x=>Util.HasValue(x[columnName])).map(x=>x[columnName]);var isString=typeof(data[0])=='string';data.forEach(item=>{if(sb.length>0){sb+=",";}
sb+=isString?`'${item}'`:(item);});retVal=this.TryParse(sb);break;}
catch(_b){}}}
else{var result=yield context.CheckSourceHeartbeatAsync(item.Source);retVal=this.TryParse(result.toString());}}}
return retVal;});}}
class SimpleTokenElement{}
class ValueToken{constructor(value){this._value=value;}
GetValueAsync(context){return new Promise(resolve=>resolve(this._value));}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class SourceCommand extends CommandBase{constructor(element,ctorCallback){super(element);this.ConnectionName=element.GetStringToken('source');this.Members=new Array();this.Element.querySelectorAll('member').forEach(elm=>this.Members.push(ctorCallback(elm)));}
ExecuteCommandAsync(context){var _a;return __awaiter(this,void 0,void 0,function*(){if((((_a=this.Members)===null||_a===void 0?void 0:_a.length)||0)>0){var name=yield Util.GetValueOrDefaultAsync(this.Name,context);var dataSet=yield this.LoadDataAsync(name,context);var tables=Object.getOwnPropertyNames(dataSet.Tabels);if(this.Members.length!=tables.length){throw new Error(`Command '${name}' Has ${this.Members.length} Member(s) But ${tables.length} Result(s) Returned From Source!`);}
this.Members.forEach((member,index)=>__awaiter(this,void 0,void 0,function*(){var source=dataSet.Tabels[tables[index]];yield member.AddDataSourceAsync(source,name,context);}));}
this.Element.remove();return VoidResult.Result;});}
LoadDataAsync(sourceName,context){return __awaiter(this,void 0,void 0,function*(){var connectionName=yield Util.GetValueOrDefaultAsync(this.ConnectionName,context);var commnad=this.Element.outerHTML.ToStringToken();var params={'command':yield Util.GetValueOrDefaultAsync(commnad,context),'dmnid':context.GetDefault('dmnid')};var name=yield Util.GetValueOrDefaultAsync(this.Name,context,null);return yield context.LoadDataAsync(sourceName,connectionName,params);});}}
class DbSource extends SourceCommand{constructor(element){super(element,x=>new DbSourceMember(x));}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class Member{constructor(element){this.Name=element.getAttribute('name');this.Preview=element.GetBooleanToken('preview');this.Sort=element.GetStringToken('sort');this.PostSql=element.GetStringToken('postsql');this.RawContent=element.textContent.ToStringToken();}
AddDataSourceAsync(source,sourceSchemaName,context){return __awaiter(this,void 0,void 0,function*(){var postSqlTask=Util.GetValueOrDefaultAsync(this.PostSql,context,null);var sortTask=Util.GetValueOrDefaultAsync(this.Sort,context,null);var previewTask=Util.GetValueOrDefaultAsync(this.Preview,context,false);source.Name=`${sourceSchemaName}.${this.Name}`.toLowerCase();Util.AddToContext(source,context,yield previewTask,yield sortTask,yield postSqlTask);});}}
class DbSourceMember extends Member{constructor(element){super(element);}}
var __awaiter=(this&&this.__awaiter)||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value);});}
return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value));}catch(e){reject(e);}}
function rejected(value){try{step(generator["throw"](value));}catch(e){reject(e);}}
function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected);}
step((generator=generator.apply(thisArg,_arguments||[])).next());});};class InlineSource extends SourceCommand{constructor(element){super(element,InlineSourceMemberConverter.ConvertToMember);}
ExecuteCommandAsync(context){var _a;return __awaiter(this,void 0,void 0,function*(){if((((_a=this.Members)===null||_a===void 0?void 0:_a.length)||0)>0){var name=yield Util.GetValueOrDefaultAsync(this.Name,context);var tasks=Array();this.Members.forEach(member=>tasks.push(member.AddDataSourceExAsync(name,context)));yield Promise.all(tasks);}
return VoidResult.Result;});}}
class InlineSourceMemberConverter{static ConvertToMember(element){var _a;var retVal=null;var type=(_a=element.getAttribute('type'))===null||_a===void 0?void 0:_a.toLowerCase();switch(type){case'sql':{retVal=new SqlMember(element);}}
return retVal;}}
class InMemoryMember extends Member{constructor(element){super(element);}
AddDataSourceExAsync(sourceSchemaName,context){const _super=Object.create(null,{AddDataSourceAsync:{get:()=>super.AddDataSourceAsync}});return __awaiter(this,void 0,void 0,function*(){var source=yield this.ParseDataAsync(context);if(source){_super.AddDataSourceAsync.call(this,source,sourceSchemaName,context);}});}}
class SqlMember extends InMemoryMember{constructor(element){super(element);this.DataMemberNames=element.GetStringToken("datamembername");}
ParseDataAsync(context){return __awaiter(this,void 0,void 0,function*(){var sources=(yield Util.GetValueOrDefaultAsync(this.DataMemberNames,context)).split(',');var sqlTask=Util.GetValueOrDefaultAsync(this.RawContent,context);return null;});}}
class IntegerArray extends ArrayToken{TryParse(value){try{return parseInt(value);}
catch(_a){}
return 0;}
constructor(...collection){super(...collection);}}
class IntegerObject extends ObjectToken{constructor(rawValue){super(rawValue);}
TryParse(value){try{return parseInt(value);}
catch(_a){}
return 0;}}
class IntegerValue extends ValueToken{constructor(data){super(data);}}
class BooleanArray extends ArrayToken{TryParse(value){return Util.HasValue(value)?value.toLowerCase()=='true':false;}
constructor(...collection){super(...collection);}}
class BooleanObject extends ObjectToken{constructor(rawValue){super(rawValue);}
TryParse(value){return Util.HasValue(value)?value.toLowerCase()=='true':false;}}
class BooleanValue extends ValueToken{constructor(data){super(data);}}
class StringArray extends ArrayToken{TryParse(value){return value;}
constructor(...collection){super(...collection);}}
class StringObject extends ObjectToken{constructor(rawValue){super(rawValue);}
TryParse(value){return value;}}
class StringValue extends ValueToken{constructor(data){super(data);}}